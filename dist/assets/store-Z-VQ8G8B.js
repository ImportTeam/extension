import{r as v,a as I}from"./client-5jyeqxZ7.js";import{s as y,E as w}from"./index-CtnQ7lw9.js";const j=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),H=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,o)=>o?o.toUpperCase():r.toLowerCase()),x=e=>{const t=H(e);return t.charAt(0).toUpperCase()+t.slice(1)},R=(...e)=>e.filter((t,r,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===r).join(" ").trim(),F=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var J={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const G=v.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:s="",children:n,iconNode:u,...l},m)=>v.createElement("svg",{ref:m,...J,width:t,height:t,stroke:e,strokeWidth:o?Number(r)*24/Number(t):r,className:R("lucide",s),...!n&&!F(l)&&{"aria-hidden":"true"},...l},[...u.map(([i,h])=>v.createElement(i,h)),...Array.isArray(n)?n:[n]]));const K=(e,t)=>{const r=v.forwardRef(({className:o,...s},n)=>v.createElement(G,{ref:n,iconNode:t,className:R(`lucide-${j(x(e))}`,`lucide-${e}`,o),...s}));return r.displayName=x(e),r};const W=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ce=K("x",W),L=e=>{let t;const r=new Set,o=(i,h)=>{const p=typeof i=="function"?i(t):i;if(!Object.is(p,t)){const g=t;t=h??(typeof p!="object"||p===null)?p:Object.assign({},t,p),r.forEach(f=>f(t,g))}},s=()=>t,l={setState:o,getState:s,getInitialState:()=>m,subscribe:i=>(r.add(i),()=>r.delete(i))},m=t=e(o,s,l);return l},X=(e=>e?L(e):L),Z=e=>e;function Y(e,t=Z){const r=I.useSyncExternalStore(e.subscribe,I.useCallback(()=>t(e.getState()),[e,t]),I.useCallback(()=>t(e.getInitialState()),[e,t]));return I.useDebugValue(r),r}const q=e=>{const t=X(e),r=o=>Y(t,o);return Object.assign(r,t),r},U=(e=>q);function Q(e,t){let r;try{r=e()}catch{return}return{getItem:s=>{var n;const u=m=>m===null?null:JSON.parse(m,void 0),l=(n=r.getItem(s))!=null?n:null;return l instanceof Promise?l.then(u):u(l)},setItem:(s,n)=>r.setItem(s,JSON.stringify(n,void 0)),removeItem:s=>r.removeItem(s)}}const P=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(o){return P(o)(r)},catch(o){return this}}}catch(r){return{then(o){return this},catch(o){return P(o)(r)}}}},z=(e,t)=>(r,o,s)=>{let n={storage:Q(()=>localStorage),partialize:a=>a,version:0,merge:(a,S)=>({...S,...a}),...t},u=!1;const l=new Set,m=new Set;let i=n.storage;if(!i)return e((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),r(...a)},o,s);const h=()=>{const a=n.partialize({...o()});return i.setItem(n.name,{state:a,version:n.version})},p=s.setState;s.setState=(a,S)=>(p(a,S),h());const g=e((...a)=>(r(...a),h()),o,s);s.getInitialState=()=>g;let f;const k=()=>{var a,S;if(!i)return;u=!1,l.forEach(c=>{var d;return c((d=o())!=null?d:g)});const E=((S=n.onRehydrateStorage)==null?void 0:S.call(n,(a=o())!=null?a:g))||void 0;return P(i.getItem.bind(i))(n.name).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==n.version){if(n.migrate){const d=n.migrate(c.state,c.version);return d instanceof Promise?d.then(b=>[!0,b]):[!0,d]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,c.state];return[!1,void 0]}).then(c=>{var d;const[b,$]=c;if(f=n.merge($,(d=o())!=null?d:g),r(f,!0),b)return h()}).then(()=>{E?.(f,void 0),f=o(),u=!0,m.forEach(c=>c(f))}).catch(c=>{E?.(void 0,c)})};return s.persist={setOptions:a=>{n={...n,...a},a.storage&&(i=a.storage)},clearStorage:()=>{i?.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>k(),hasHydrated:()=>u,onHydrate:a=>(l.add(a),()=>{l.delete(a)}),onFinishHydration:a=>(m.add(a),()=>{m.delete(a)})},n.skipHydration||k(),f||g},B=z,M={isLoading:!1,isExpanded:!1,showPaymentMethod:!1,selectedTab:"recommendation",error:null},C={recommendation:null,alternatives:[],discounts:null,cardBenefits:null},A={timestamp:0,siteId:void 0},V=e=>({...M,setLoading:t=>{e({isLoading:t})},toggleExpanded:()=>{e(t=>({isExpanded:!t.isExpanded}))},setShowPaymentMethod:t=>{e({showPaymentMethod:t})},setSelectedTab:t=>{e({selectedTab:t})},setError:t=>{e({error:t})},resetUI:()=>{e(M)}}),ee=e=>({...C,setRecommendation:t=>{e({recommendation:t})},setAlternatives:t=>{e({alternatives:t})},setDiscounts:t=>{e({discounts:t})},setCardBenefits:t=>{e({cardBenefits:t})},resetData:()=>{e(C)}}),te=e=>({...A,updateTimestamp:()=>{e({timestamp:Date.now()})},setSiteId:t=>{e({siteId:t})},resetMeta:()=>{e(A)}}),re={getItem:async e=>new Promise(t=>{chrome.storage.local.get([e],r=>{if(chrome.runtime.lastError){y.warn("chromeStorage getItem failed",{key:e,error:chrome.runtime.lastError.message}),t(null);return}t(r[e]??null)})}),setItem:async(e,t)=>new Promise((r,o)=>{chrome.storage.local.set({[e]:t},()=>{if(chrome.runtime.lastError){const s=new Error(`chromeStorage setItem failed: ${chrome.runtime.lastError.message}`);y.error(w.STO_E001,"chromeStorage setItem failed",{data:{key:e},error:s}),o(new Error(chrome.runtime.lastError.message??"Failed to save to storage"));return}r()})}),removeItem:async e=>new Promise((t,r)=>{chrome.storage.local.remove([e],()=>{if(chrome.runtime.lastError){const o=new Error(`chromeStorage removeItem failed: ${chrome.runtime.lastError.message}`);y.error(w.STO_E001,"chromeStorage removeItem failed",{data:{key:e},error:o}),r(new Error(chrome.runtime.lastError.message??"Failed to remove from storage"));return}t()})})};function D(){return re}const N={RECOMMENDATION:"picsel-recommendation",SUBPOPUP:"subpopup-store"},T=1800*1e3,oe=U()(B((...e)=>({...V(...e),...ee(...e),...te(...e),reset:()=>{const[t]=e;t({...M,...C,...A})}}),{name:N.RECOMMENDATION,storage:D(),partialize:e=>({recommendation:e.recommendation,alternatives:e.alternatives,discounts:e.discounts,cardBenefits:e.cardBenefits,siteId:e.siteId,timestamp:e.timestamp}),onRehydrateStorage:()=>(e,t)=>{if(t){y.error(w.STO_E003,"Store rehydration failed",{error:t instanceof Error?t:new Error(String(t))});return}if(e&&e.timestamp){const r=Date.now()-e.timestamp;r>T&&(y.info("ðŸ”„ Cache expired, resetting recommendation store",{age:`${Math.floor(r/1e3)}s`,maxAge:`${T/1e3}s`}),oe.setState({recommendation:null,alternatives:[],discounts:null,cardBenefits:null}))}}})),O={isOpen:!1,activeTab:"list",isLoading:!1,error:null},_={customMethods:[]},ne=e=>({...O,setIsOpen:t=>{e({isOpen:t})},setActiveTab:t=>{e({activeTab:t})},setIsLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},resetUI:()=>{e(O)}}),se=e=>({..._,addPaymentMethod:t=>{const r=Date.now(),o={...t,createdAt:r,updatedAt:r,isCustom:!0};e(s=>({customMethods:[...s.customMethods,o]}))},updatePaymentMethod:(t,r)=>{e(o=>({customMethods:o.customMethods.map(s=>s.id===t?{...s,...r,updatedAt:Date.now()}:s)}))},deletePaymentMethod:t=>{e(r=>({customMethods:r.customMethods.filter(o=>o.id!==t)}))},setCustomMethods:t=>{e({customMethods:t})},resetPayment:()=>{e(_)}}),le=U()(B((...e)=>({...ne(...e),...se(...e),reset:()=>{const[t]=e;t({...O,..._})}}),{name:N.SUBPOPUP,storage:D(),partialize:e=>({customMethods:e.customMethods})}));export{ce as X,le as a,K as c,oe as u};
