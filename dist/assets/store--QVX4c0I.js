import{r as v,a as I}from"./client-5jyeqxZ7.js";const T=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),N=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,o)=>o?o.toUpperCase():r.toLowerCase()),L=e=>{const t=N(e);return t.charAt(0).toUpperCase()+t.slice(1)},U=(...e)=>e.filter((t,r,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===r).join(" ").trim(),j=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var H={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const F=v.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:s="",children:n,iconNode:u,...l},m)=>v.createElement("svg",{ref:m,...H,width:t,height:t,stroke:e,strokeWidth:o?Number(r)*24/Number(t):r,className:U("lucide",s),...!n&&!j(l)&&{"aria-hidden":"true"},...l},[...u.map(([i,h])=>v.createElement(i,h)),...Array.isArray(n)?n:[n]]));const $=(e,t)=>{const r=v.forwardRef(({className:o,...s},n)=>v.createElement(F,{ref:n,iconNode:t,className:U(`lucide-${T(L(e))}`,`lucide-${e}`,o),...s}));return r.displayName=L(e),r};const J=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ne=$("x",J),R=e=>{let t;const r=new Set,o=(i,h)=>{const f=typeof i=="function"?i(t):i;if(!Object.is(f,t)){const g=t;t=h??(typeof f!="object"||f===null)?f:Object.assign({},t,f),r.forEach(p=>p(t,g))}},s=()=>t,l={setState:o,getState:s,getInitialState:()=>m,subscribe:i=>(r.add(i),()=>r.delete(i))},m=t=e(o,s,l);return l},G=(e=>e?R(e):R),K=e=>e;function W(e,t=K){const r=I.useSyncExternalStore(e.subscribe,I.useCallback(()=>t(e.getState()),[e,t]),I.useCallback(()=>t(e.getInitialState()),[e,t]));return I.useDebugValue(r),r}const X=e=>{const t=G(e),r=o=>W(t,o);return Object.assign(r,t),r},_=(e=>X);function Z(e,t){let r;try{r=e()}catch{return}return{getItem:s=>{var n;const u=m=>m===null?null:JSON.parse(m,void 0),l=(n=r.getItem(s))!=null?n:null;return l instanceof Promise?l.then(u):u(l)},setItem:(s,n)=>r.setItem(s,JSON.stringify(n,void 0)),removeItem:s=>r.removeItem(s)}}const E=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(o){return E(o)(r)},catch(o){return this}}}catch(r){return{then(o){return this},catch(o){return E(o)(r)}}}},Y=(e,t)=>(r,o,s)=>{let n={storage:Z(()=>localStorage),partialize:a=>a,version:0,merge:(a,S)=>({...S,...a}),...t},u=!1;const l=new Set,m=new Set;let i=n.storage;if(!i)return e((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),r(...a)},o,s);const h=()=>{const a=n.partialize({...o()});return i.setItem(n.name,{state:a,version:n.version})},f=s.setState;s.setState=(a,S)=>(f(a,S),h());const g=e((...a)=>(r(...a),h()),o,s);s.getInitialState=()=>g;let p;const O=()=>{var a,S;if(!i)return;u=!1,l.forEach(c=>{var d;return c((d=o())!=null?d:g)});const y=((S=n.onRehydrateStorage)==null?void 0:S.call(n,(a=o())!=null?a:g))||void 0;return E(i.getItem.bind(i))(n.name).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==n.version){if(n.migrate){const d=n.migrate(c.state,c.version);return d instanceof Promise?d.then(b=>[!0,b]):[!0,d]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,c.state];return[!1,void 0]}).then(c=>{var d;const[b,D]=c;if(p=n.merge(D,(d=o())!=null?d:g),r(p,!0),b)return h()}).then(()=>{y?.(p,void 0),p=o(),u=!0,m.forEach(c=>c(p))}).catch(c=>{y?.(void 0,c)})};return s.persist={setOptions:a=>{n={...n,...a},a.storage&&(i=a.storage)},clearStorage:()=>{i?.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>O(),hasHydrated:()=>u,onHydrate:a=>(l.add(a),()=>{l.delete(a)}),onFinishHydration:a=>(m.add(a),()=>{m.delete(a)})},n.skipHydration||O(),p||g},k=Y,w={isLoading:!1,isExpanded:!1,showPaymentMethod:!1,selectedTab:"recommendation",error:null},P={recommendation:null,alternatives:[],discounts:null,cardBenefits:null},M={timestamp:0,siteId:void 0},q=e=>({...w,setLoading:t=>{e({isLoading:t})},toggleExpanded:()=>{e(t=>({isExpanded:!t.isExpanded}))},setShowPaymentMethod:t=>{e({showPaymentMethod:t})},setSelectedTab:t=>{e({selectedTab:t})},setError:t=>{e({error:t})},resetUI:()=>{e(w)}}),Q=e=>({...P,setRecommendation:t=>{e({recommendation:t})},setAlternatives:t=>{e({alternatives:t})},setDiscounts:t=>{e({discounts:t})},setCardBenefits:t=>{e({cardBenefits:t})},resetData:()=>{e(P)}}),z=e=>({...M,updateTimestamp:()=>{e({timestamp:Date.now()})},setSiteId:t=>{e({siteId:t})},resetMeta:()=>{e(M)}}),V={getItem:async e=>new Promise(t=>{chrome.storage.local.get([e],r=>{if(chrome.runtime.lastError){console.warn("[chromeStorage] getItem error:",chrome.runtime.lastError.message),t(null);return}t(r[e]??null)})}),setItem:async(e,t)=>new Promise((r,o)=>{chrome.storage.local.set({[e]:t},()=>{if(chrome.runtime.lastError){console.error("[chromeStorage] setItem error:",chrome.runtime.lastError.message),o(new Error(chrome.runtime.lastError.message??"Failed to save to storage"));return}r()})}),removeItem:async e=>new Promise((t,r)=>{chrome.storage.local.remove([e],()=>{if(chrome.runtime.lastError){console.error("[chromeStorage] removeItem error:",chrome.runtime.lastError.message),r(new Error(chrome.runtime.lastError.message??"Failed to remove from storage"));return}t()})})};function x(){return V}const B={RECOMMENDATION:"picsel-recommendation",SUBPOPUP:"subpopup-store"},ee=1800*1e3,se=_()(k((...e)=>({...q(...e),...Q(...e),...z(...e),reset:()=>{const[t]=e;t({...w,...P,...M})}}),{name:B.RECOMMENDATION,storage:x(),partialize:e=>({recommendation:e.recommendation,alternatives:e.alternatives,discounts:e.discounts,cardBenefits:e.cardBenefits,siteId:e.siteId,timestamp:e.timestamp}),onRehydrateStorage:()=>e=>{e&&e.timestamp&&Date.now()-e.timestamp>ee&&(e.recommendation=null,e.alternatives=[],e.discounts=null,e.cardBenefits=null)}})),C={isOpen:!1,activeTab:"list",isLoading:!1,error:null},A={customMethods:[]},te=e=>({...C,setIsOpen:t=>{e({isOpen:t})},setActiveTab:t=>{e({activeTab:t})},setIsLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},resetUI:()=>{e(C)}}),re=e=>({...A,addPaymentMethod:t=>{const r=Date.now(),o={...t,createdAt:r,updatedAt:r,isCustom:!0};e(s=>({customMethods:[...s.customMethods,o]}))},updatePaymentMethod:(t,r)=>{e(o=>({customMethods:o.customMethods.map(s=>s.id===t?{...s,...r,updatedAt:Date.now()}:s)}))},deletePaymentMethod:t=>{e(r=>({customMethods:r.customMethods.filter(o=>o.id!==t)}))},setCustomMethods:t=>{e({customMethods:t})},resetPayment:()=>{e(A)}}),ae=_()(k((...e)=>({...te(...e),...re(...e),reset:()=>{const[t]=e;t({...C,...A})}}),{name:B.SUBPOPUP,storage:x(),partialize:e=>({customMethods:e.customMethods})}));export{ne as X,ae as a,$ as c,se as u};
