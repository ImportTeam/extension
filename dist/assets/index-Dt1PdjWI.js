var i=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n[n.FATAL=4]="FATAL",n))(i||{});const N={0:"DEBUG",1:"INFO",2:"WARN",3:"ERROR",4:"FATAL"},h={0:"#9E9E9E",1:"#2196F3",2:"#FF9800",3:"#F44336",4:"#9C27B0"},g={0:"ðŸ”",1:"ðŸ“˜",2:"âš ï¸",3:"âŒ",4:"ðŸ’€"};var r=(n=>(n.CONTENT="CONTENT",n.BACKGROUND="BACKGROUND",n.POPUP="POPUP",n.SUBPOPUP="SUBPOPUP",n.OPTIONS="OPTIONS",n.OFFSCREEN="OFFSCREEN",n))(r||{}),a=(n=>(n.PARSER="PARSER",n.STORE="STORE",n.UI="UI",n.NETWORK="NETWORK",n.DOM="DOM",n.STORAGE="STORAGE",n.SECURITY="SECURITY",n.BOOTSTRAP="BOOTSTRAP",n.EXTENSION="EXTENSION",n.GENERAL="GENERAL",n))(a||{});const o={PAR_E001:"PAR-E001",PAR_E002:"PAR-E002",PAR_E003:"PAR-E003",PAR_E004:"PAR-E004",PAR_E005:"PAR-E005",PAR_E006:"PAR-E006",PAR_E007:"PAR-E007",STO_E001:"STO-E001",STO_E002:"STO-E002",STO_E003:"STO-E003",STO_E004:"STO-E004",NET_E001:"NET-E001",NET_E002:"NET-E002",NET_E003:"NET-E003",NET_E004:"NET-E004",UI_E001:"UI-E001",UI_E002:"UI-E002",UI_E003:"UI-E003",DOM_E001:"DOM-E001",DOM_E002:"DOM-E002",DOM_E003:"DOM-E003",STG_E001:"STG-E001",STG_E002:"STG-E002",STG_E003:"STG-E003",SEC_E001:"SEC-E001",SEC_E002:"SEC-E002",SEC_E003:"SEC-E003",BST_E001:"BST-E001",BST_E002:"BST-E002",BST_E003:"BST-E003",EXT_E001:"EXT-E001",EXT_E002:"EXT-E002",EXT_E003:"EXT-E003",GEN_E001:"GEN-E001",GEN_E002:"GEN-E002",GEN_E003:"GEN-E003"},O={[o.PAR_E001]:"Price extraction failed",[o.PAR_E002]:"Product info extraction failed",[o.PAR_E003]:"Card benefits extraction failed",[o.PAR_E004]:"Selector not found",[o.PAR_E005]:"Invalid data format",[o.PAR_E006]:"Site not supported",[o.PAR_E007]:"DOM structure changed",[o.STO_E001]:"State update failed",[o.STO_E002]:"Persist failed",[o.STO_E003]:"Rehydration failed",[o.STO_E004]:"Invalid state",[o.NET_E001]:"Message send failed",[o.NET_E002]:"Message receive timeout",[o.NET_E003]:"Invalid message format",[o.NET_E004]:"Port disconnected",[o.UI_E001]:"Render failed",[o.UI_E002]:"Component mount failed",[o.UI_E003]:"Event handler error",[o.DOM_E001]:"Element not found",[o.DOM_E002]:"Mutation observer error",[o.DOM_E003]:"Injection failed",[o.STG_E001]:"Storage read failed",[o.STG_E002]:"Storage write failed",[o.STG_E003]:"Storage quota exceeded",[o.SEC_E001]:"XSS attempt detected",[o.SEC_E002]:"CSP violation",[o.SEC_E003]:"Invalid origin",[o.BST_E001]:"Initialization failed",[o.BST_E002]:"Dependency missing",[o.BST_E003]:"Invalid context",[o.EXT_E001]:"Extension initialization failed",[o.EXT_E002]:"Permission denied",[o.EXT_E003]:"API unavailable",[o.GEN_E001]:"Unknown error",[o.GEN_E002]:"Validation failed",[o.GEN_E003]:"Type mismatch"},P={minLevel:typeof process<"u"?1:0,environment:"CONTENT",enableConsole:!0,enableStorage:typeof process<"u"&&!0,enableRemote:!1,includeLocation:typeof process>"u"||!1,maxStoredLogs:1e3};class l{static instance;config;storedLogs=[];correlationId;constructor(e={}){this.config={...P,environment:this.detectEnvironment(),...e}}static getInstance(e){return l.instance||(l.instance=new l(e)),l.instance}detectEnvironment(){if(typeof chrome<"u"&&chrome.runtime){const e=globalThis.location?.href||"";return e.includes("popup.html")?r.POPUP:e.includes("subpopup")||e.includes("auto=true")?r.SUBPOPUP:e.includes("options.html")?r.OPTIONS:e.includes("offscreen")?r.OFFSCREEN:typeof window>"u"||!document?r.BACKGROUND:r.CONTENT}return r.CONTENT}getSourceLocation(){if(this.config.includeLocation)try{const e=new Error().stack;if(!e)return;const t=e.split(`
`),E=(t[4]||t[3]||"").match(/at\s+(?:(.+?)\s+)?\(?(.+?):(\d+):(\d+)\)?/);if(E)return{function:E[1]||"anonymous",file:E[2]?.split("/").pop()||E[2],line:parseInt(E[3],10),column:parseInt(E[4],10)}}catch{}}createEntry(e,t,s,E={}){return{timestamp:Date.now(),level:e,environment:this.config.environment,domain:t,message:s,code:E.code,location:this.getSourceLocation(),data:E.data,error:E.error,correlationId:this.correlationId}}formatEntry(e){const t=g[e.level],s=N[e.level],E=h[e.level],d=e.environment.substring(0,3).toUpperCase(),_=e.domain.substring(0,3).toUpperCase(),f=new Date(e.timestamp),R=f.toTimeString().split(" ")[0]+"."+String(f.getMilliseconds()).padStart(3,"0"),u=e.location?`${e.location.file}:${e.location.line}`:"",S=e.code?`[${e.code}]`:"";return{prefix:`${t} [${R}] [${d}/${_}] ${s}${S?" "+S:""}${u?" @ "+u:""}`,message:e.message,style:`color: ${E}; font-weight: bold;`,data:e.data}}output(e){if(!(e.level<this.config.minLevel)){if(this.config.enableConsole){const t=this.formatEntry(e),s=this.getConsoleMethod(e.level);t.data!==void 0?s(`%c${t.prefix}`,t.style,t.message,t.data):s(`%c${t.prefix}`,t.style,t.message),e.error&&s(e.error)}this.config.enableStorage&&this.storeLog(e)}}getConsoleMethod(e){switch(e){case i.DEBUG:return console.debug.bind(console);case i.INFO:return console.info.bind(console);case i.WARN:return console.warn.bind(console);case i.ERROR:case i.FATAL:return console.error.bind(console);default:return console.log.bind(console)}}storeLog(e){this.storedLogs.push(e),this.storedLogs.length>this.config.maxStoredLogs&&(this.storedLogs=this.storedLogs.slice(-this.config.maxStoredLogs))}configure(e){this.config={...this.config,...e}}setEnvironment(e){this.config.environment=e}setCorrelationId(e){this.correlationId=e}clearCorrelationId(){this.correlationId=void 0}debug(e,t,s){this.output(this.createEntry(i.DEBUG,e,t,{data:s}))}info(e,t,s){this.output(this.createEntry(i.INFO,e,t,{data:s}))}warn(e,t,s){this.output(this.createEntry(i.WARN,e,t,{data:s}))}error(e,t,s,E){const d=s||O[t];this.output(this.createEntry(i.ERROR,e,d,{code:t,data:E?.data,error:E?.error}))}fatal(e,t,s,E){const d=s||O[t];this.output(this.createEntry(i.FATAL,e,d,{code:t,data:E?.data,error:E?.error}))}getLogs(e){let t=[...this.storedLogs];if(e?.level!==void 0){const s=e.level;t=t.filter(E=>E.level>=s)}if(e?.domain&&(t=t.filter(s=>s.domain===e.domain)),e?.since!==void 0){const s=e.since;t=t.filter(E=>E.timestamp>=s)}return t}clearLogs(){this.storedLogs=[]}exportLogs(){return JSON.stringify(this.storedLogs,null,2)}group(e){this.config.enableConsole&&console.group(e)}groupEnd(){this.config.enableConsole&&console.groupEnd()}time(e){this.config.enableConsole&&console.time(e)}timeEnd(e){this.config.enableConsole&&console.timeEnd(e)}}const T=l.getInstance();function c(n,e){return{debug:(t,s)=>T.debug(n,t,s),info:(t,s)=>T.info(n,t,s),warn:(t,s)=>T.warn(n,t,s),error:(t,s,E)=>T.error(n,t||e,s,E),fatal:(t,s,E)=>T.fatal(n,t||e,s,E)}}const p=c(a.PARSER,o.PAR_E001),m=p,I=c(a.STORE,o.STO_E001);c(a.UI,o.UI_E001);const C=c(a.NETWORK,o.NET_E001),U=c(a.DOM,o.DOM_E001),G=c(a.BOOTSTRAP,o.BST_E001),b=c(a.EXTENSION,o.EXT_E001);export{o as E,a as L,m as a,G as b,U as d,b as e,T as l,C as n,p,I as s};
