import{c as R,j as t,X as E,R as A}from"./x-DnYY5WB9.js";import{r as f,R as z}from"./chromeStorage-Dg3q2KGi.js";import{u as d}from"./store-CRXnNwZ9.js";import"./index-CtnQ7lw9.js";import{T as c}from"./tokenManager-BtvXDoI5.js";import{W as x}from"./constants-DOucEiR9.js";/* empty css                */const W=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],I=R("settings",W),v=()=>d(e=>e.isLoading),L=()=>d(e=>e.isExpanded),_=()=>d(e=>e.selectedTab),H=()=>d(e=>e.error),y=()=>d(e=>e.recommendation),M=()=>d(e=>e.alternatives),O=()=>d(e=>e.discounts),N=()=>d(e=>e.cardBenefits),U=()=>{const e=y(),n=v();return!e&&!n},D=()=>{const e=y(),n=v();return!!e&&!n},w=()=>d(e=>({setLoading:e.setLoading,setRecommendation:e.setRecommendation,setAlternatives:e.setAlternatives,setDiscounts:e.setDiscounts,setCardBenefits:e.setCardBenefits,toggleExpanded:e.toggleExpanded,setSelectedTab:e.setSelectedTab,setShowPaymentMethod:e.setShowPaymentMethod,setError:e.setError,reset:e.reset})),F={light:{background:"#ffffff",cardBg:"#ffffff",buttonDark:"#393E44",buttonHover:"#2d3136",textPrimary:"#111827",textSecondary:"#4b5563"}},l=F.light,g={container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"16px 0"},card:{padding:"24px 20px",background:l.cardBg,borderRadius:"20px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",textAlign:"center",maxWidth:"260px",width:"100%"},label:{fontSize:"14px",color:l.textPrimary,marginBottom:"8px",fontWeight:"700",letterSpacing:"0.3px"},amount:{fontSize:"36px",fontWeight:"900",color:l.textPrimary,margin:"0 0 6px 0",lineHeight:"1.1",letterSpacing:"-1.5px"},text:{fontSize:"13px",color:l.textSecondary,margin:"0",fontWeight:"500"}};var S={};const m=typeof process<"u"&&S?.REACT_APP_SERVER_URL?S.REACT_APP_SERVER_URL:"https://api.picsel.kr",$={async login(e,n){const o=await fetch(`${m}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:n})});if(!o.ok){const i=await o.json();throw new Error(i.message||"Login failed")}const r=await o.json(),a={accessToken:r.accessToken,refreshToken:r.refreshToken,expiresAt:Date.now()+r.expiresIn*1e3};return await c.saveToken(a),r},async refreshToken(){const e=await c.getToken();if(!e)throw new Error("No refresh token available");const n=await fetch(`${m}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.refreshToken}`}});if(!n.ok)throw await c.clearToken(),new Error("Token refresh failed");const o=await n.json(),r={accessToken:o.accessToken,refreshToken:e.refreshToken,expiresAt:Date.now()+o.expiresIn*1e3};return await c.saveToken(r),r},async logout(){const e=await c.getToken();if(e)try{await fetch(`${m}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${e.accessToken}`}})}catch(n){console.warn("Logout API failed:",n)}await c.clearToken()},async getCurrentUser(e){const n=await fetch(`${m}/auth/me`,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw new Error("Failed to fetch user info");return n.json()},async fetchWithAuth(e,n={}){const o=await c.getToken();if(!o)throw new Error("Not authenticated: Please login first");if(c.shouldRefreshToken(o))try{const a=await this.refreshToken();n.headers={...n.headers,Authorization:`Bearer ${a.accessToken}`}}catch(a){console.warn("Silent refresh failed:",a),n.headers={...n.headers,Authorization:`Bearer ${o.accessToken}`}}else n.headers={...n.headers,Authorization:`Bearer ${o.accessToken}`};const r=await fetch(e,n);if(r.status===401)throw await c.clearToken(),new Error("Unauthorized: Please login again");return r}};var T={};const V=typeof process<"u"&&T?.REACT_APP_SERVER_URL?T.REACT_APP_SERVER_URL:"https://api.picsel.kr",G={async getSavingsMetrics(){try{const e=await $.fetchWithAuth(`${V}/api/dashboard/metrics/savings`);return e.ok?(await e.json()).data||null:(console.warn("Failed to fetch savings metrics:",e.statusText),null)}catch(e){return e instanceof Error&&e.message.includes("Not authenticated")?console.warn("Savings metrics: user not authenticated"):console.warn("Error fetching savings metrics:",e),null}}},j="â‚©0",K=()=>{const[e,n]=f.useState(j),[o,r]=f.useState(!0);return f.useEffect(()=>{const i=setTimeout(async()=>{try{const h=await G.getSavingsMetrics();h?.savingsAmountKrw?n(h.savingsAmountKrw):n(j)}catch(h){console.warn("Failed to load savings:",h),n(j)}finally{r(!1)}},500);return()=>clearTimeout(i)},[]),t.jsx("div",{style:g.container,children:t.jsxs("div",{style:g.card,children:[t.jsx("div",{style:g.label,className:"idle-label",children:t.jsx("span",{children:"ì´ë²ˆë‹¬"})}),t.jsx("div",{style:g.amount,children:o?"ë¡œë”©...":e}),t.jsx("p",{style:g.text,children:"ì ˆì•½í–ˆì–´ìš”"})]})})},J=()=>{const e=M(),{setRecommendation:n}=w();return!e||e.length===0?t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"ì¶”ê°€ ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤."}):t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"ë‹¤ë¥¸ ê²°ì œ ìˆ˜ë‹¨"}),t.jsx("div",{className:"space-y-2",children:e.map(o=>t.jsxs("button",{onClick:()=>n(o),className:`
              w-full p-3 rounded-md
              bg-white dark:bg-gray-700
              border border-gray-200 dark:border-gray-600
              hover:border-primary dark:hover:border-primary
              transition-all
              text-left
            `,children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:o.name}),o.hasInstallment&&o.installmentInfo&&t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:o.installmentInfo})]}),t.jsxs("p",{className:"font-semibold text-success text-sm",children:["â‚©",o.savingAmount.toLocaleString()]})]}),t.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["ìˆ˜ìˆ˜ë£Œ: ",o.fee,"%",o.baseFee>o.fee&&t.jsxs("span",{className:"text-success ml-1",children:["(vs ",o.baseFee,"%)"]})]})]},o.id))})]})},X=e=>!e||e.length===0?null:t.jsxs("div",{style:{marginBottom:"12px",padding:"10px",backgroundColor:"#fef3c7",borderRadius:"6px"},children:[t.jsx("p",{style:{fontSize:"12px",fontWeight:"bold",color:"#92400e",margin:"0 0 8px 0"},children:"ðŸ’° ì¶”ê°€ í• ì¸ ì •ë³´"}),e.map((n,o)=>t.jsxs("div",{style:{fontSize:"12px",color:"#78350f",marginBottom:o<e.length-1?"4px":"0"},children:["â€¢ ",n.type,": ",n.rate,"% í• ì¸"]},o))]}),Y=e=>!e||e.length===0?null:t.jsxs("div",{style:{marginBottom:"12px",padding:"10px",backgroundColor:"#fce7f3",borderRadius:"6px"},children:[t.jsx("p",{style:{fontSize:"12px",fontWeight:"bold",color:"#831843",margin:"0 0 8px 0"},children:"ðŸŽ ì¹´ë“œ í˜œíƒ"}),e.map((n,o)=>t.jsxs("div",{style:{fontSize:"12px",color:"#9f1239",marginBottom:o<e.length-1?"4px":"0"},children:["â€¢ ",n.card,": ",n.benefit]},o))]}),q=()=>t.jsx("button",{style:{width:"100%",padding:"12px",backgroundColor:"#4f46e5",color:"#ffffff",fontSize:"14px",fontWeight:"bold",border:"none",borderRadius:"6px",cursor:"pointer"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#4338ca",onMouseOut:e=>e.currentTarget.style.backgroundColor="#4f46e5",onClick:()=>window.close(),children:"ì´ ê²°ì œ ìˆ˜ë‹¨ìœ¼ë¡œ ê²°ì œí•˜ê¸°"}),Q=()=>{const e=y(),n=L(),o=O(),r=N(),{toggleExpanded:a}=w();return e?t.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden",marginBottom:"0"},children:[t.jsxs("div",{style:{padding:"12px"},children:[t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",margin:"0",color:"#000"},children:e.name})}),t.jsxs("div",{style:{marginBottom:"12px"},children:[t.jsxs("div",{style:{fontSize:"clamp(20px, 8vw, 28px)",fontWeight:"bold",color:"#10b981",margin:"0 0 4px 0"},children:["â‚©",e.savingAmount.toLocaleString()," ì ˆì•½"]}),t.jsx("p",{style:{fontSize:"clamp(10px, 3vw, 12px)",color:"#666",margin:"0"},children:"ì´ ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ ì‹œ ì ˆì•½ ê°€ëŠ¥"})]}),t.jsx("div",{style:{marginBottom:"12px",padding:"10px",backgroundColor:"#f9fafb",borderRadius:"6px"},children:t.jsxs("p",{style:{fontSize:"12px",color:"#555",margin:"0"},children:["ìˆ˜ìˆ˜ë£Œ:",t.jsxs("span",{style:{fontWeight:"bold",marginLeft:"4px"},children:[e.fee,"%"]})," vs ",t.jsxs("span",{style:{fontWeight:"bold",marginLeft:"4px"},children:[e.baseFee,"%"]})]})}),e.confidence>=.95&&t.jsx("div",{style:{marginBottom:"12px",fontSize:"12px",color:"#10b981",fontWeight:"bold"},children:"âœ“ ë†’ì€ ì‹ ë¢°ë„ ì¶”ì²œ"}),e.hasInstallment&&e.installmentInfo&&t.jsx("div",{style:{marginBottom:"12px",padding:"8px",backgroundColor:"#eff6ff",borderRadius:"6px",fontSize:"12px",color:"#0284c7"},children:e.installmentInfo}),X(o),Y(r),q()]}),n&&t.jsx("div",{style:{borderTop:"1px solid #e5e7eb"},children:t.jsx(J,{})}),t.jsx("button",{onClick:a,style:{width:"100%",padding:"12px",textAlign:"center",fontSize:"12px",fontWeight:"bold",color:"#4f46e5",backgroundColor:"#f9fafb",border:"none",cursor:"pointer",borderTop:"1px solid #e5e7eb"},onMouseOver:i=>i.currentTarget.style.backgroundColor="#f3f4f6",onMouseOut:i=>i.currentTarget.style.backgroundColor="#f9fafb",children:n?"ì˜µì…˜ ìˆ¨ê¸°ê¸°":"ë‹¤ë¥¸ ì˜µì…˜ ë³´ê¸°"})]}):t.jsx("div",{style:{padding:"16px",textAlign:"center",color:"#999"},children:"ì¶”ì²œí•  ê²°ì œ ìˆ˜ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤."})},Z=()=>{const e=y();return e?t.jsxs("div",{style:{padding:"12px"},children:[t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h3",{style:{fontSize:"13px",fontWeight:"bold",margin:"0 0 12px 0"},children:"ìˆ˜ìˆ˜ë£Œ ëª…ì„¸"}),t.jsxs("div",{style:{backgroundColor:"#f9fafb",borderRadius:"6px",padding:"12px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"12px"},children:[t.jsxs("span",{children:[e.name," ìˆ˜ìˆ˜ë£Œ:"]}),t.jsxs("span",{style:{fontWeight:"bold"},children:[e.fee,"%"]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"12px"},children:[t.jsx("span",{children:"ê¸°ì¤€ ìˆ˜ìˆ˜ë£Œ:"}),t.jsxs("span",{style:{fontWeight:"bold"},children:[e.baseFee,"%"]})]}),t.jsx("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:"8px",marginTop:"8px"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px"},children:[t.jsx("span",{style:{fontWeight:"bold",color:"#10b981"},children:"ì ˆì•½ì•¡:"}),t.jsxs("span",{style:{fontWeight:"bold",color:"#10b981"},children:["â‚©",e.savingAmount.toLocaleString()]})]})})]})]}),e.hasInstallment&&e.installmentInfo&&t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h3",{style:{fontSize:"13px",fontWeight:"bold",margin:"0 0 12px 0"},children:"í• ë¶€ ì •ë³´"}),t.jsx("div",{style:{backgroundColor:"#eff6ff",borderRadius:"6px",padding:"12px",fontSize:"12px",color:"#0284c7"},children:e.installmentInfo})]}),e.confidence>=.95&&t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"13px",fontWeight:"bold",margin:"0 0 12px 0"},children:"ì¶”ì²œ ì‹ ë¢°ë„"}),t.jsxs("div",{style:{fontSize:"12px",color:"#10b981"},children:["âœ“ ",Math.round(e.confidence*100),"% ì‹ ë¢°ë„"]})]})]}):null},ee=()=>{const e=_(),{setSelectedTab:n}=w();return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>n("recommendation"),style:{flex:1,padding:"8px 12px",fontSize:"12px",fontWeight:"bold",borderRadius:"6px",border:"none",backgroundColor:e==="recommendation"?"#4f46e5":"#f3f4f6",color:e==="recommendation"?"#ffffff":"#374151",cursor:"pointer",transition:"all 0.2s ease"},children:"ì¶”ì²œ"}),t.jsx("button",{onClick:()=>n("settings"),style:{flex:1,padding:"8px 12px",fontSize:"12px",fontWeight:"bold",borderRadius:"6px",border:"none",backgroundColor:e==="settings"?"#4f46e5":"#f3f4f6",color:e==="settings"?"#ffffff":"#374151",cursor:"pointer",transition:"all 0.2s ease"},children:"ìƒì„¸ì •ë³´"})]}),e==="recommendation"&&t.jsx(Q,{}),e==="settings"&&t.jsx(Z,{})]})},p={container:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px 20px 20px 20px",backgroundColor:l.background,borderTop:"none",flexShrink:0},primaryButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"52px",border:"none",borderRadius:"16px",backgroundColor:l.buttonDark,color:"#ffffff",fontSize:"15px",fontWeight:"700",cursor:"pointer",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 2px 8px rgba(79, 70, 229, 0.15), 0 1px 2px rgba(79, 70, 229, 0.1)"},primaryButtonHover:{backgroundColor:l.buttonHover,transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(79, 70, 229, 0.2), 0 2px 4px rgba(79, 70, 229, 0.15)"},secondaryButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"40px",border:"none",borderRadius:"0",backgroundColor:"transparent",color:"#9ca3af",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"color 0.2s ease"},secondaryButtonHover:{color:"#6b7280"}},te=()=>{const e=()=>{chrome.windows.create({url:chrome.runtime.getURL("src/subpopup/index.html"),type:"popup",width:480,height:640})},n=()=>{chrome.tabs.create({url:"https://www.picsel.kr/dashboard/cards",active:!1})},[o,r]=f.useState(!1),[a,i]=f.useState(!1);return t.jsxs("div",{style:p.container,children:[t.jsx("button",{onClick:n,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:a?{...p.primaryButton,...p.primaryButtonHover}:p.primaryButton,children:"ì „ì²´ ë¦¬í¬íŠ¸ë³´ê¸°"}),t.jsx("button",{onClick:e,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),style:o?{...p.secondaryButton,...p.secondaryButtonHover}:p.secondaryButton,children:"ë‚´ ê²°ì œìˆ˜ë‹¨ë³´ëŸ¬ ê°€ê¸°"})]})},s={container:{width:"100%",minWidth:`${x.POPUP.minWidth}px`,maxWidth:`${x.POPUP.maxWidth}px`,minHeight:`${x.POPUP.idleHeight}px`,display:"flex",flexDirection:"column",backgroundColor:"#f5f5f7",color:l.textPrimary,fontFamily:'"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',overflow:"hidden",boxSizing:"border-box"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",backgroundColor:"#F5F6F5",flexShrink:0,zIndex:10},logoContainer:{display:"flex",alignItems:"center",gap:"10px"},logo:{height:"24px",width:"auto",objectFit:"contain"},title:{fontSize:"18px",fontWeight:"800",margin:"0",color:l.textPrimary,letterSpacing:"-0.5px"},iconButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#393E44",borderRadius:"8px",transition:"all 0.2s ease"},iconButtonHover:{backgroundColor:"rgba(57, 62, 68, 0.08)",color:"#393E44"},content:{flex:1,padding:"0 20px",overflow:"hidden",display:"flex",flexDirection:"column"},loading:{textAlign:"center",padding:"40px 0",color:l.textSecondary,fontSize:"14px"},error:{padding:"16px",backgroundColor:"#fef2f2",borderRadius:"12px",border:"1px solid #fee2e2",margin:"16px 0"},errorText:{color:"#b91c1c",margin:"0",fontSize:"13px",lineHeight:"1.5",fontWeight:"500"}},ne=()=>{const e=v(),n=H(),o=U(),r=D(),[a,i]=f.useState(!1),[h,k]=f.useState(!1),C=o?x.POPUP.idleHeight:x.POPUP.expandedHeight,B=()=>{const b=chrome.runtime.getURL("src/options/index.html");try{chrome.windows.create({url:b,type:"popup",width:x.SUBPOPUP.width,height:x.SUBPOPUP.height},()=>{const u=chrome.runtime.lastError;u&&(console.warn("[Popup] Failed to open options popup window:",u.message),typeof chrome.runtime.openOptionsPage=="function"?chrome.runtime.openOptionsPage():window.open(b,"_blank"))})}catch(u){console.warn("[Popup] Exception while opening options:",u),typeof chrome.runtime.openOptionsPage=="function"?chrome.runtime.openOptionsPage():window.open(b,"_blank")}};return t.jsxs("div",{style:{...s.container,height:`${C}px`,flex:"0 0 auto"},children:[t.jsxs("div",{style:s.header,children:[t.jsxs("div",{style:s.logoContainer,children:[t.jsx("img",{src:"/assets/icon/picsel-logo.png",alt:"PicSel",style:s.logo}),t.jsx("h1",{style:s.title,children:"PicSel"})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:B,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:a?{...s.iconButton,...s.iconButtonHover}:s.iconButton,title:"ê²°ì œ ìˆ˜ë‹¨ ì„¤ì •",children:t.jsx(I,{size:20,strokeWidth:2.5})}),t.jsx("button",{onClick:()=>window.close(),onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),style:h?{...s.iconButton,...s.iconButtonHover}:s.iconButton,title:"ë‹«ê¸°",children:t.jsx(E,{size:20,strokeWidth:2.5})})]})]}),t.jsxs("div",{style:s.content,children:[e&&t.jsx("div",{style:s.loading,children:t.jsx("p",{children:"ë¡œë”© ì¤‘..."})}),n&&!e&&t.jsx("div",{style:s.error,children:t.jsx("p",{style:s.errorText,children:n})}),o&&t.jsx(K,{}),r&&t.jsx(ee,{}),!o&&!r&&!e&&!n&&t.jsx("div",{style:s.loading,children:t.jsx("p",{children:"ì´ˆê¸°í™” ì¤‘..."})})]}),t.jsx(te,{})]})},P=document.getElementById("root");P&&A.createRoot(P).render(t.jsx(z.StrictMode,{children:t.jsx(ne,{})}));
