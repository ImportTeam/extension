import{r as v,a as b}from"./client-5jyeqxZ7.js";const T=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),N=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,o)=>o?o.toUpperCase():n.toLowerCase()),L=e=>{const t=N(e);return t.charAt(0).toUpperCase()+t.slice(1)},U=(...e)=>e.filter((t,n,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===n).join(" ").trim(),j=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var H={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $=v.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:s="",children:r,iconNode:d,...l},u)=>v.createElement("svg",{ref:u,...H,width:t,height:t,stroke:e,strokeWidth:o?Number(n)*24/Number(t):n,className:U("lucide",s),...!r&&!j(l)&&{"aria-hidden":"true"},...l},[...d.map(([i,p])=>v.createElement(i,p)),...Array.isArray(r)?r:[r]]));const F=(e,t)=>{const n=v.forwardRef(({className:o,...s},r)=>v.createElement($,{ref:r,iconNode:t,className:U(`lucide-${T(L(e))}`,`lucide-${e}`,o),...s}));return n.displayName=L(e),n};const J=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],re=F("x",J),R=e=>{let t;const n=new Set,o=(i,p)=>{const f=typeof i=="function"?i(t):i;if(!Object.is(f,t)){const S=t;t=p??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(h=>h(t,S))}},s=()=>t,l={setState:o,getState:s,getInitialState:()=>u,subscribe:i=>(n.add(i),()=>n.delete(i))},u=t=e(o,s,l);return l},G=(e=>e?R(e):R),K=e=>e;function W(e,t=K){const n=b.useSyncExternalStore(e.subscribe,b.useCallback(()=>t(e.getState()),[e,t]),b.useCallback(()=>t(e.getInitialState()),[e,t]));return b.useDebugValue(n),n}const X=e=>{const t=G(e),n=o=>W(t,o);return Object.assign(n,t),n},_=(e=>X);function Z(e,t){let n;try{n=e()}catch{return}return{getItem:s=>{var r;const d=u=>u===null?null:JSON.parse(u,void 0),l=(r=n.getItem(s))!=null?r:null;return l instanceof Promise?l.then(d):d(l)},setItem:(s,r)=>n.setItem(s,JSON.stringify(r,void 0)),removeItem:s=>n.removeItem(s)}}const P=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(o){return P(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return P(o)(n)}}}},Y=(e,t)=>(n,o,s)=>{let r={storage:Z(()=>localStorage),partialize:a=>a,version:0,merge:(a,g)=>({...g,...a}),...t},d=!1;const l=new Set,u=new Set;let i=r.storage;if(!i)return e((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...a)},o,s);const p=()=>{const a=r.partialize({...o()});return i.setItem(r.name,{state:a,version:r.version})},f=s.setState;s.setState=(a,g)=>(f(a,g),p());const S=e((...a)=>(n(...a),p()),o,s);s.getInitialState=()=>S;let h;const O=()=>{var a,g;if(!i)return;d=!1,l.forEach(c=>{var m;return c((m=o())!=null?m:S)});const y=((g=r.onRehydrateStorage)==null?void 0:g.call(r,(a=o())!=null?a:S))||void 0;return P(i.getItem.bind(i))(r.name).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==r.version){if(r.migrate){const m=r.migrate(c.state,c.version);return m instanceof Promise?m.then(I=>[!0,I]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,c.state];return[!1,void 0]}).then(c=>{var m;const[I,D]=c;if(h=r.merge(D,(m=o())!=null?m:S),n(h,!0),I)return p()}).then(()=>{y?.(h,void 0),h=o(),d=!0,u.forEach(c=>c(h))}).catch(c=>{y?.(void 0,c)})};return s.persist={setOptions:a=>{r={...r,...a},a.storage&&(i=a.storage)},clearStorage:()=>{i?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>O(),hasHydrated:()=>d,onHydrate:a=>(l.add(a),()=>{l.delete(a)}),onFinishHydration:a=>(u.add(a),()=>{u.delete(a)})},r.skipHydration||O(),h||S},k=Y,w={isLoading:!1,isExpanded:!1,showPaymentMethod:!1,selectedTab:"recommendation",error:null},M={recommendation:null,alternatives:[],discounts:null,cardBenefits:null},C={timestamp:0,siteId:void 0},q=e=>({...w,setLoading:t=>{e({isLoading:t})},toggleExpanded:()=>{e(t=>({isExpanded:!t.isExpanded}))},setShowPaymentMethod:t=>{e({showPaymentMethod:t})},setSelectedTab:t=>{e({selectedTab:t})},setError:t=>{e({error:t})},resetUI:()=>{e(w)}}),Q=e=>({...M,setRecommendation:t=>{e({recommendation:t})},setAlternatives:t=>{e({alternatives:t})},setDiscounts:t=>{e({discounts:t})},setCardBenefits:t=>{e({cardBenefits:t})},resetData:()=>{e(M)}}),z=e=>({...C,updateTimestamp:()=>{e({timestamp:Date.now()})},setSiteId:t=>{e({siteId:t})},resetMeta:()=>{e(C)}}),V={getItem:async e=>new Promise(t=>{chrome.storage.local.get([e],n=>{t(n[e]??null)})}),setItem:async(e,t)=>new Promise(n=>{chrome.storage.local.set({[e]:t},()=>{n()})}),removeItem:async e=>new Promise(t=>{chrome.storage.local.remove([e],()=>{t()})})};function x(){return V}const B={RECOMMENDATION:"picsel-recommendation",SUBPOPUP:"subpopup-store"},ee=1800*1e3,se=_()(k((...e)=>({...q(...e),...Q(...e),...z(...e),reset:()=>{const[t]=e;t({...w,...M,...C})}}),{name:B.RECOMMENDATION,storage:x(),partialize:e=>({recommendation:e.recommendation,alternatives:e.alternatives,discounts:e.discounts,cardBenefits:e.cardBenefits,siteId:e.siteId,timestamp:e.timestamp}),onRehydrateStorage:()=>e=>{e&&e.timestamp&&Date.now()-e.timestamp>ee&&(e.recommendation=null,e.alternatives=[],e.discounts=null,e.cardBenefits=null)}})),E={isOpen:!1,activeTab:"list",isLoading:!1,error:null},A={customMethods:[]},te=e=>({...E,setIsOpen:t=>{e({isOpen:t})},setActiveTab:t=>{e({activeTab:t})},setIsLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},resetUI:()=>{e(E)}}),ne=e=>({...A,addPaymentMethod:t=>{const n=Date.now(),o={...t,createdAt:n,updatedAt:n,isCustom:!0};e(s=>({customMethods:[...s.customMethods,o]}))},updatePaymentMethod:(t,n)=>{e(o=>({customMethods:o.customMethods.map(s=>s.id===t?{...s,...n,updatedAt:Date.now()}:s)}))},deletePaymentMethod:t=>{e(n=>({customMethods:n.customMethods.filter(o=>o.id!==t)}))},setCustomMethods:t=>{e({customMethods:t})},resetPayment:()=>{e(A)}}),ae=_()(k((...e)=>({...te(...e),...ne(...e),reset:()=>{const[t]=e;t({...E,...A})}}),{name:B.SUBPOPUP,storage:x(),partialize:e=>({customMethods:e.customMethods})}));export{re as X,ae as a,F as c,se as u};
