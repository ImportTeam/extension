import{c as u,p,a as S,S as M,M as m}from"./chromeStorage-BOBytA-p.js";import{s as l,E as h}from"./index-CtnQ7lw9.js";const n={isLoading:!1,isExpanded:!1,showPaymentMethod:!1,selectedTab:"recommendation",error:null},i={recommendation:null,alternatives:[],discounts:null,cardBenefits:null},r={timestamp:0,siteId:void 0},f=e=>({...n,setLoading:t=>{e({isLoading:t})},toggleExpanded:()=>{e(t=>({isExpanded:!t.isExpanded}))},setShowPaymentMethod:t=>{e({showPaymentMethod:t})},setSelectedTab:t=>{e({selectedTab:t})},setError:t=>{e({error:t})},resetUI:()=>{e(n)}}),P=e=>({...i,setRecommendation:t=>{e({recommendation:t})},setAlternatives:t=>{e({alternatives:t})},setDiscounts:t=>{e({discounts:t})},setCardBenefits:t=>{e({cardBenefits:t})},resetData:()=>{e(i)}}),E=e=>({...r,updateTimestamp:()=>{e({timestamp:Date.now()})},setSiteId:t=>{e({siteId:t})},resetMeta:()=>{e(r)}}),g=u()(p((...e)=>({...f(...e),...P(...e),...E(...e),reset:()=>{const[t]=e;t({...n,...i,...r})}}),{name:M.RECOMMENDATION,storage:S(),partialize:e=>({recommendation:e.recommendation,alternatives:e.alternatives,discounts:e.discounts,cardBenefits:e.cardBenefits,siteId:e.siteId,timestamp:e.timestamp}),onRehydrateStorage:()=>(e,t)=>{if(t){l.error(h.STO_E003,"Store rehydration failed",{error:t instanceof Error?t:new Error(String(t))});return}if(e&&e.timestamp){const a=Date.now()-e.timestamp;a>m&&(l.info("ðŸ”„ Cache expired, resetting recommendation store",{age:`${Math.floor(a/1e3)}s`,maxAge:`${m/1e3}s`}),g.setState({recommendation:null,alternatives:[],discounts:null,cardBenefits:null}))}}})),d={isOpen:!1,activeTab:"list",isLoading:!1,error:null},c={customMethods:[]},I=e=>({...d,setIsOpen:t=>{e({isOpen:t})},setActiveTab:t=>{e({activeTab:t})},setIsLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},resetUI:()=>{e(d)}}),b=e=>({...c,addPaymentMethod:t=>{const a=Date.now(),o={...t,createdAt:a,updatedAt:a,isCustom:!0};e(s=>({customMethods:[...s.customMethods,o]}))},updatePaymentMethod:(t,a)=>{e(o=>({customMethods:o.customMethods.map(s=>s.id===t?{...s,...a,updatedAt:Date.now()}:s)}))},deletePaymentMethod:t=>{e(a=>({customMethods:a.customMethods.filter(o=>o.id!==t)}))},setCustomMethods:t=>{e({customMethods:t})},resetPayment:()=>{e(c)}}),v=u()(p((...e)=>({...I(...e),...b(...e),reset:()=>{const[t]=e;t({...d,...c})}}),{name:M.SUBPOPUP,storage:S(),partialize:e=>({customMethods:e.customMethods})}));export{v as a,g as u};
