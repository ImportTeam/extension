var u=Object.defineProperty;var o=(t,e,r)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var a=(t,e,r)=>o(t,typeof e!="symbol"?e+"":e,r);import{b as s}from"./assets/logger-DEAfARFT.js";class m{constructor(){a(this,"metrics",[]);a(this,"batchSize",100);a(this,"flushInterval",6e4);setInterval(()=>this.flush(),this.flushInterval)}increment(e,r){this.addMetric(e,1,r)}timing(e,r,c){this.addMetric(e,r,c)}gauge(e,r,c){this.addMetric(e,r,c)}addMetric(e,r,c){const i={name:e,value:r,tags:c,timestamp:Date.now()};this.metrics.push(i),this.metrics.length>=this.batchSize&&this.flush()}async flush(){if(this.metrics.length===0)return;const e=[...this.metrics];this.metrics=[];try{s.debug("Flushing metrics",{count:e.length})}catch(r){s.error("Failed to flush metrics",r,{count:e.length}),this.metrics.unshift(...e)}}}const n=new m;chrome.runtime.onInstalled.addListener(t=>{s.info("Extension installed",{reason:t.reason}),chrome.alarms&&chrome.alarms.create("processQueue",{periodInMinutes:1}),chrome.storage.local.set({settings:{autoRecommend:!0,preferredCurrency:"KRW"}}),n.increment("extension.installed",{reason:t.reason})});chrome.runtime.onMessage.addListener((t,e,r)=>{switch(s.debug("Message received",{type:t.type}),t.type){case"CALCULATE_PAYMENT":return l(t.data,r),!0;case"GET_QUEUE_STATUS":return h(r),!0;case"TRIGGER_PROCESS":return d(r),!0;default:s.warn("Unknown message type",{type:t.type}),r({success:!1,error:"Unknown message type"})}});chrome.alarms&&chrome.alarms.onAlarm.addListener(async t=>{s.debug("Alarm triggered",{name:t.name}),t.name==="processQueue"&&(s.info("Queue processing triggered"),n.increment("alarm.processQueue"))});async function l(t,e){try{s.info("Payment calculation requested",{data:t}),e({success:!0,message:"Calculation queued"})}catch(r){s.error("Failed to handle payment calculation",r,{data:t}),e({success:!1,error:r.message})}}async function h(t){try{t({success:!0,status:"Queue not implemented yet"})}catch(e){t({success:!1,error:e.message})}}async function d(t){try{t({success:!0,message:"Process triggered"})}catch(e){t({success:!1,error:e.message})}}
